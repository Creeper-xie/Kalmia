# 数据包

每个数据包均需要以"数据包ID"开头，以 [Base256](/doc/zh_cn/standard/transport/number/number_encode_standard.md)
进行数字编码，请见：[数据包标准](/doc/zh_cn/standard/transport/packet/packet_standard.md)

## 格式

|   长度   | 2 ~ 9 字节 |  1 字节   | 2~9 字节  | X 字节  |
|:------:|:--------:|:-------:|:-------:|:-----:|
|   作用   |  数据包长度   |  加密类型   |  数据包ID  | 数据包数据 |
|   定值   |          |         |         |       |
| 值（或候选） |  数据包的长度  | 加密类型ID  |  数据包ID  | 数据包数据 |
|   描述   | 确定要读多少数据 | 用于网络序列化 | 用于网络序列化 | 数据包数据 |

# 握手

## Client Hello

``` 此数据包的接收方为：服务端 ```

客户端Hello包格式：

|   长度   |           1 或 9 字节           | 2~9 字节  | X 字节  |
|:------:|:----------------------------:|:-------:|:-----:|
|   作用   |            数据包ID             |  数据长度   | 数据主体  |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 0] |         |       |
| 值（或候选） |             [0]              | 数据主体的长度 | 客户端数据 |
|   描述   |           用于网络序列化            | 标记数据长度  | 客户端数据 |

## RSA Pubkey Request

``` 此数据包的接收方为：客户端 ```

在客户端将Client Hello送达服务端时

服务端判断客户端要求使用RSA公钥，则服务端会发送RSA公钥请求：

|   长度   |           2 或 9 字节           |  2 字节   |  X 字节   |
|:------:|:----------------------------:|:-------:|:-------:|
|   作用   |            数据包ID             |  数据长度   |  数据主体   |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 1] |         |         |
| 值（或候选） |            [1, 1]            | 数据主体的长度 | 明文RSA公钥 |
|   描述   |           用于网络序列化            | 标记公钥长度  | 明文RSA公钥 |

通常这只在首次连接AES密钥更新时会被发送

## AES Genkey Request

``` 此数据包的接收方为：服务端 ```

在服务端将RSA公钥请求送达客户端时，客户端会发送AES密钥请求：

|   长度   |           2 或 9 字节           |  2 字节   |  X 字节   |
|:------:|:----------------------------:|:-------:|:-------:|
|   作用   |            数据包ID             |  数据长度   |  数据主体   |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 2] |         |         |
| 值（或候选） |            [1, 2]            | 数据主体的长度 | 密文二进制密钥 |
|   描述   |           用于网络序列化            | 标记密文长度  | 密文二进制密钥 |

通常这只在首次连接AES密钥更新时会被发送

## Server Hello

``` 此数据包的接收方为：客户端 ```

在握手的最后一步，服务端会将客户端给的密钥加密后发回给客户端

附带原数据的SHA-512值，让客户端确认自己的的密钥是否和服务端相同，请看：[加密细节](/doc/zh_cn/encrypt/encrypt_detail.md#server-hello)

|   长度   |           2 或 9 字节           |  2 字节  |  X 字节   |    1 字节     |     X 字节      |    1 字节     |   X 字节    |
|:------:|:----------------------------:|:------:|:-------:|:-----------:|:-------------:|:-----------:|:---------:|
|   作用   |            数据包ID             |  数据长度  |  数据主体   |    摘要长度     |     数据摘要      |    数据长度     |   数据主体    |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 3] |        |         |             |               |      0      |    [0]    |
| 值（或候选） |            [1, 3]            | 密文的长度  | 密文二进制数据 |    摘要长度     |    原始数据摘要     |    IV长度     |    IV值    |
|   描述   |           用于网络序列化            | 标记密文长度 | 密文二进制数据 | SHA-512值的长度 | 原始数据的SHA-512值 | AES初始化向量的长度 | AES初始化向量值 |

# 测试

## Try Ping

``` 此数据包的接收方为：服务端 ```

|   长度   |           2 或 9 字节           | 2 ~ 9 字节 |    
|:------:|:----------------------------:|:--------:|
|   作用   |            数据包ID             | Ping起始时间 |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 4] |          |         
| 值（或候选） |            [1, 4]            | Ping起始时间 |
|   描述   |           用于网络序列化            |  标记起始时间  |

## Try Ping Response

``` 此数据包的接收方为：客户端 ```

|   长度   |           2 或 9 字节           | 2 ~ 9 字节 |    
|:------:|:----------------------------:|:--------:|
|   作用   |            数据包ID             | Ping起始时间 |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 5] |          |         
| 值（或候选） |            [1, 5]            | Ping起始时间 |
|   描述   |           用于网络序列化            |  标记起始时间  |

# 登录

```
以下内容正在等待完成，请不要参考

```

## Login with password

``` 
此数据包的接收方为：服务端
此数据包必须在已加密情况下发送（已经过握手）
```

|   长度   |           2 或 9 字节           | 2 ~ 9 字节 |     |
|:------:|:----------------------------:|:--------:|:---:|
|   作用   |            数据包ID             |  用户UID   |     |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 6] |          |     |       
| 值（或候选） |            [1, 5]            |  用户UID   |     |
|   描述   |           用于网络序列化            | 标记要登录的账户 |     |

# 消息

## Send message

``` 
此数据包的接收方为：服务端
此数据包必须在已加密情况下发送（已经过握手）
```