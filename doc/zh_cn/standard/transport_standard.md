# 数据包

# 握手

Kalmia在首次连接时不安全！

## Client Hello

``` 此数据包的接收方为：服务端 ```

客户端Hello包格式：

|   长度   |           1 或 9 字节           | 2~9 字节  | X 字节  |
|:------:|:----------------------------:|:-------:|:-----:|
|   作用   |            数据包ID             |  数据长度   | 数据主体  |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 0] |         |       |
| 值（或候选） |             [0]              | 数据主体的长度 | 客户端数据 |
|   描述   |           用于网络序列化            | 标记数据长度  | 客户端数据 |

## RSA Pubkey Request

``` 此数据包的接收方为：客户端 ```

在客户端将Client Hello送达服务端时

服务端判断客户端要求使用RSA公钥，则服务端会发送RSA公钥请求：

|   长度   |           1 或 9 字节           |  2 字节   |  X 字节   |
|:------:|:----------------------------:|:-------:|:-------:|
|   作用   |            数据包ID             |  数据长度   |  数据主体   |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 1] |         |         |
| 值（或候选） |            [1, 1]            | 数据主体的长度 | 明文RSA公钥 |
|   描述   |           用于网络序列化            | 标记公钥长度  | 明文RSA公钥 |

通常这只在首次连接AES密钥更新时会被发送

## AES Genkey Request

``` 此数据包的接收方为：服务端 ```

在服务端将RSA公钥请求送达客户端时，客户端会发送AES密钥请求：

|   长度   |           1 或 9 字节           |  2 字节   |  X 字节   |
|:------:|:----------------------------:|:-------:|:-------:|
|   作用   |            数据包ID             |  数据长度   |  数据主体   |
|   定值   | [-1, 0, 0, 0, 0, 0, 0, 0, 2] |         |         |
| 值（或候选） |            [1, 2]            | 数据主体的长度 | 密文二进制密钥 |
|   描述   |           用于网络序列化            | 标记密文长度  | 密文二进制密钥 |

通常这只在首次连接AES密钥更新时会被发送
